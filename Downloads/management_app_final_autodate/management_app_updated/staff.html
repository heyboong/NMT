<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quáº£n LÃ½ NhÃ¢n ViÃªn - Há»‡ Thá»‘ng Quáº£n LÃ½</title>
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/css/sheet.css" />
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <a href="index.html">ğŸ  Trang Chá»§</a>
        <a href="dashboard.html">ğŸ“Š Báº£ng ChÃ­nh</a>
        <a href="AE.html">ğŸ’¼ Báº£ng AE</a>
        <a href="AE-QT.html">ğŸŒ Báº£ng AE-QT</a>
        <a href="rate.html">ğŸ’± Tá»· GiÃ¡ USD</a>
        <a href="usdt-purchase.html">ğŸ’° GiÃ¡ Nháº­p USDT</a>
        <a href="balance.html">ğŸ‘¥ Danh SÃ¡ch TÃªn</a>
        <a href="staff.html" class="active">ğŸ‘¤ Quáº£n LÃ½ NV</a>
        <a href="settings.html">âš™ï¸ CÃ i Äáº·t</a>
        <a href="system.html">ğŸ”§ Quáº£n LÃ½</a>
    </nav>

    <div class="container">
        <!-- Header -->
        <div style="margin-bottom: 24px;">
            <h1 style="margin: 0 0 8px 0; color: #1f2937; display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 32px;">ğŸ‘¤</span>
                Quáº£n LÃ½ Danh SÃ¡ch NhÃ¢n ViÃªn
            </h1>
            <p style="color: #6b7280; margin: 0;">Quáº£n lÃ½ 2 danh sÃ¡ch riÃªng biá»‡t: NhÃ¢n viÃªn Báº£ng AE vÃ  NhÃ¢n viÃªn Báº£ng AE-QT</p>
        </div>

        <!-- Two columns layout -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
            
            <!-- Column 1: Báº£ng AE -->
            <div style="border: 2px solid #3b82f6; border-radius: 12px; padding: 20px; background: #f0f9ff;">
                <h3 style="margin: 0 0 16px 0; color: #1e40af; display: flex; align-items: center; gap: 8px; font-size: 18px;">
                    <span style="font-size: 24px;">ğŸ’¼</span>
                    NhÃ¢n ViÃªn Báº£ng AE
                </h3>
                
                <!-- Form thÃªm AE -->
                <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 16px; border: 1px solid #bfdbfe;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #1e40af; font-size: 13px;">â• ThÃªm NV Má»›i</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="new-staff-ae" placeholder="Nháº­p tÃªn (cÃ³ thá»ƒ nhiá»u tÃªn, cÃ¡ch nhau báº±ng dáº¥u pháº©y)" style="flex: 1; padding: 8px 10px; border: 1px solid #bfdbfe; border-radius: 6px; font-size: 13px;">
                        <button onclick="addStaffFromMain('ae')" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px; white-space: nowrap;">ThÃªm</button>
                    </div>
                    <div style="font-size: 11px; color: #6b7280; margin-top: 6px;">ğŸ’¡ VÃ­ dá»¥: An, BÃ¬nh, ChÃ¢u</div>
                </div>

                <!-- TÃ¬m kiáº¿m AE -->
                <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                    <input type="text" id="staff-search-ae" placeholder="ğŸ” TÃ¬m kiáº¿m..." style="flex: 1; padding: 8px; border: 1px solid #bfdbfe; border-radius: 6px; font-size: 13px; background: white;">
                    <button onclick="sortStaffListMain('ae')" style="padding: 8px 12px; background: #6b7280; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 12px;">A-Z</button>
                    <button onclick="exportStaffListMain('ae')" style="padding: 8px 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 12px;">ğŸ“¥</button>
                </div>

                <!-- Danh sÃ¡ch AE -->
                <div id="staff-list-ae" style="display: flex; flex-direction: column; gap: 6px; max-height: 450px; overflow-y: auto; padding: 4px;">
                    <!-- AE staff items -->
                </div>

                <!-- Empty state AE -->
                <div id="staff-empty-ae" style="display: none; text-align: center; padding: 30px 15px; background: white; border-radius: 8px; border: 1px dashed #bfdbfe;">
                    <div style="font-size: 40px; margin-bottom: 8px;">ğŸ’¼</div>
                    <p style="color: #6b7280; margin: 0; font-size: 13px;">ChÆ°a cÃ³ nhÃ¢n viÃªn AE</p>
                </div>
            </div>

            <!-- Column 2: Báº£ng AE-QT -->
            <div style="border: 2px solid #f59e0b; border-radius: 12px; padding: 20px; background: #fffbeb;">
                <h3 style="margin: 0 0 16px 0; color: #92400e; display: flex; align-items: center; gap: 8px; font-size: 18px;">
                    <span style="font-size: 24px;">ğŸŒ</span>
                    NhÃ¢n ViÃªn Báº£ng AE-QT
                </h3>
                
                <!-- Form thÃªm AE-QT -->
                <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 16px; border: 1px solid #fde68a;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #92400e; font-size: 13px;">â• ThÃªm NV Má»›i</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="new-staff-aeqt" placeholder="Nháº­p tÃªn (cÃ³ thá»ƒ nhiá»u tÃªn, cÃ¡ch nhau báº±ng dáº¥u pháº©y)" style="flex: 1; padding: 8px 10px; border: 1px solid #fde68a; border-radius: 6px; font-size: 13px;">
                        <button onclick="addStaffFromMain('aeqt')" style="padding: 8px 16px; background: #f59e0b; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px; white-space: nowrap;">ThÃªm</button>
                    </div>
                    <div style="font-size: 11px; color: #6b7280; margin-top: 6px;">ğŸ’¡ VÃ­ dá»¥: An, BÃ¬nh, ChÃ¢u</div>
                </div>

                <!-- TÃ¬m kiáº¿m AE-QT -->
                <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                    <input type="text" id="staff-search-aeqt" placeholder="ğŸ” TÃ¬m kiáº¿m..." style="flex: 1; padding: 8px; border: 1px solid #fde68a; border-radius: 6px; font-size: 13px; background: white;">
                    <button onclick="sortStaffListMain('aeqt')" style="padding: 8px 12px; background: #6b7280; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 12px;">A-Z</button>
                    <button onclick="exportStaffListMain('aeqt')" style="padding: 8px 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 12px;">ğŸ“¥</button>
                </div>

                <!-- Danh sÃ¡ch AE-QT -->
                <div id="staff-list-aeqt" style="display: flex; flex-direction: column; gap: 6px; max-height: 450px; overflow-y: auto; padding: 4px;">
                    <!-- AE-QT staff items -->
                </div>

                <!-- Empty state AE-QT -->
                <div id="staff-empty-aeqt" style="display: none; text-align: center; padding: 30px 15px; background: white; border-radius: 8px; border: 1px dashed #fde68a;">
                    <div style="font-size: 40px; margin-bottom: 8px;">ğŸŒ</div>
                    <p style="color: #6b7280; margin: 0; font-size: 13px;">ChÆ°a cÃ³ nhÃ¢n viÃªn AE-QT</p>
                </div>
            </div>

        </div>

        <!-- Info box -->
        <div style="margin-top: 20px; padding: 12px 16px; background: #e0f2fe; border-left: 4px solid #0284c7; border-radius: 6px;">
            <p style="margin: 0; color: #0c4a6e; font-size: 13px; line-height: 1.6;">
                <strong>ğŸ’¡ LÆ°u Ã½:</strong> Hai danh sÃ¡ch riÃªng biá»‡t giÃºp trÃ¡nh nháº§m láº«n khi chá»n nhÃ¢n viÃªn. Danh sÃ¡ch bÃªn trÃ¡i cho Báº£ng AE (Nháº­n Ã—0.5), bÃªn pháº£i cho Báº£ng AE-QT (Nháº­n Ã—0.8).
            </p>
        </div>

        <!-- HÆ°á»›ng dáº«n -->
        <div style="margin-top: 24px; padding: 16px; background: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 8px;">
            <h3 style="margin: 0 0 12px 0; color: #1e40af; font-size: 16px;">ğŸ“– HÆ°á»›ng Dáº«n Sá»­ Dá»¥ng</h3>
            <ul style="margin: 0; padding-left: 20px; color: #1e40af; line-height: 1.8;">
                <li><strong>ThÃªm nhÃ¢n viÃªn:</strong> Nháº­p tÃªn vÃ  nháº¥n "ThÃªm" hoáº·c Enter. CÃ³ thá»ƒ thÃªm nhiá»u tÃªn cÃ¹ng lÃºc (cÃ¡ch nhau báº±ng dáº¥u pháº©y)</li>
                <li><strong>Danh sÃ¡ch riÃªng:</strong> NhÃ¢n viÃªn AE vÃ  AE-QT Ä‘Æ°á»£c quáº£n lÃ½ riÃªng biá»‡t Ä‘á»ƒ phÃ¹ há»£p vá»›i tá»«ng báº£ng</li>
                <li><strong>Sá»­ dá»¥ng:</strong> Khi nháº­p vÃ o cá»™t "TÃªn NV" trong Báº£ng AE hoáº·c AE-QT, danh sÃ¡ch tÆ°Æ¡ng á»©ng sáº½ gá»£i Ã½ tá»± Ä‘á»™ng</li>
                <li><strong>Chá»‰nh sá»­a:</strong> Click nÃºt "âœï¸ Sá»­a" Ä‘á»ƒ chá»‰nh sá»­a tÃªn</li>
                <li><strong>XÃ³a:</strong> Click nÃºt ğŸ—‘ï¸ Ä‘á»ƒ xÃ³a nhÃ¢n viÃªn khá»i danh sÃ¡ch</li>
                <li><strong>TÃ¬m kiáº¿m:</strong> GÃµ vÃ o Ã´ tÃ¬m kiáº¿m Ä‘á»ƒ lá»c danh sÃ¡ch nhanh</li>
                <li><strong>Xuáº¥t dá»¯ liá»‡u:</strong> Click nÃºt ğŸ“¥ Ä‘á»ƒ xuáº¥t danh sÃ¡ch ra file CSV</li>
            </ul>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/supabase-sync.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="assets/js/button-effects.js"></script>
    <script>
        // Staff Manager - Same logic as balance.html but without modal
        const STAFF_AE_KEY = 'staff_list_ae';
        const STAFF_AEQT_KEY = 'staff_list_aeqt';
        let staffListAE = [];
        let staffListAEQT = [];
        let staffSortAscendingAE = true;
        let staffSortAscendingAEQT = true;

        // Load staff lists from localStorage
        function loadStaffListData() {
            try {
                const storedAE = localStorage.getItem(STAFF_AE_KEY);
                const storedAEQT = localStorage.getItem(STAFF_AEQT_KEY);
                staffListAE = storedAE ? JSON.parse(storedAE) : [];
                staffListAEQT = storedAEQT ? JSON.parse(storedAEQT) : [];
            } catch (e) {
                console.error('Error loading staff lists:', e);
                staffListAE = [];
                staffListAEQT = [];
            }
        }

        // Save staff list to localStorage
        function saveStaffListData(type) {
            try {
                if (type === 'ae') {
                    localStorage.setItem(STAFF_AE_KEY, JSON.stringify(staffListAE));
                } else {
                    localStorage.setItem(STAFF_AEQT_KEY, JSON.stringify(staffListAEQT));
                }
            } catch (e) {
                console.error('Error saving staff list:', e);
                alert('Lá»—i khi lÆ°u danh sÃ¡ch!');
            }
        }

        // Add staff
        window.addStaff = function(name, type, silent = false) {
            loadStaffListData();
            
            if (!name || name.trim() === '') {
                if (!silent) alert('Vui lÃ²ng nháº­p tÃªn nhÃ¢n viÃªn!');
                return false;
            }

            const trimmedName = name.trim();
            const list = type === 'ae' ? staffListAE : staffListAEQT;
            
            if (list.some(s => s.toLowerCase() === trimmedName.toLowerCase())) {
                return false;
            }

            if (type === 'ae') {
                staffListAE.push(trimmedName);
            } else {
                staffListAEQT.push(trimmedName);
            }
            
            saveStaffListData(type);
            if (!silent) {
                showNotification('âœ… ÄÃ£ thÃªm: ' + trimmedName);
            }
            return true;
        }

        // Edit staff
        window.editStaff = function(oldName, newName, type) {
            loadStaffListData();
            
            if (!newName || newName.trim() === '') {
                alert('Vui lÃ²ng nháº­p tÃªn má»›i!');
                return false;
            }

            const trimmedNewName = newName.trim();
            const list = type === 'ae' ? staffListAE : staffListAEQT;
            
            if (list.some(s => s !== oldName && s.toLowerCase() === trimmedNewName.toLowerCase())) {
                alert('TÃªn nÃ y Ä‘Ã£ tá»“n táº¡i!');
                return false;
            }

            const index = list.indexOf(oldName);
            if (index > -1) {
                if (type === 'ae') {
                    staffListAE[index] = trimmedNewName;
                } else {
                    staffListAEQT[index] = trimmedNewName;
                }
                saveStaffListData(type);
                showNotification('âœ… ÄÃ£ sá»­a: ' + trimmedNewName);
                return true;
            }
            return false;
        }

        // Delete staff
        window.deleteStaff = function(name, type) {
            loadStaffListData();
            
            const list = type === 'ae' ? staffListAE : staffListAEQT;
            const index = list.indexOf(name);
            
            if (index > -1) {
                if (type === 'ae') {
                    staffListAE.splice(index, 1);
                } else {
                    staffListAEQT.splice(index, 1);
                }
                saveStaffListData(type);
                showNotification('ğŸ—‘ï¸ ÄÃ£ xÃ³a: ' + name);
                return true;
            }
            return false;
        }

        // Sort staff list
        window.sortStaffList = function(type) {
            loadStaffListData();
            
            if (type === 'ae') {
                staffListAE.sort((a, b) => {
                    return staffSortAscendingAE 
                        ? a.localeCompare(b, 'vi') 
                        : b.localeCompare(a, 'vi');
                });
                staffSortAscendingAE = !staffSortAscendingAE;
                saveStaffListData('ae');
            } else {
                staffListAEQT.sort((a, b) => {
                    return staffSortAscendingAEQT 
                        ? a.localeCompare(b, 'vi') 
                        : b.localeCompare(a, 'vi');
                });
                staffSortAscendingAEQT = !staffSortAscendingAEQT;
                saveStaffListData('aeqt');
            }
        }

        // Export staff list
        window.exportStaffList = function(type) {
            loadStaffListData();
            
            const list = type === 'ae' ? staffListAE : staffListAEQT;
            const label = type === 'ae' ? 'AE' : 'AE-QT';
            
            if (list.length === 0) {
                alert('Danh sÃ¡ch trá»‘ng!');
                return;
            }

            const csvContent = '\uFEFF' + 'STT,TÃªn NhÃ¢n ViÃªn ' + label + '\n' + 
                list.map((name, i) => `${i + 1},"${name}"`).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'Staff_' + label + '_' + new Date().toISOString().split('T')[0] + '.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('ğŸ“¥ ÄÃ£ xuáº¥t file CSV - ' + label);
        }

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10b981;
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadStaffListData();
            renderStaffListMain('ae');
            renderStaffListMain('aeqt');
            
            // Enter key support
            document.getElementById('new-staff-ae')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addStaffFromMain('ae');
            });
            
            document.getElementById('new-staff-aeqt')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addStaffFromMain('aeqt');
            });

            // Search
            document.getElementById('staff-search-ae')?.addEventListener('input', function() {
                renderStaffListMain('ae');
            });
            
            document.getElementById('staff-search-aeqt')?.addEventListener('input', function() {
                renderStaffListMain('aeqt');
            });
        });

        // Add staff from main page
        window.addStaffFromMain = function(type) {
            const inputId = type === 'ae' ? 'new-staff-ae' : 'new-staff-aeqt';
            const input = document.getElementById(inputId);
            if (!input) return;
            
            const inputValue = input.value.trim();
            if (!inputValue) {
                alert('Vui lÃ²ng nháº­p tÃªn nhÃ¢n viÃªn!');
                return;
            }
            
            const names = inputValue.split(',').map(name => name.trim()).filter(name => name.length > 0);
            
            if (names.length === 0) {
                alert('Vui lÃ²ng nháº­p tÃªn há»£p lá»‡!');
                return;
            }
            
            let addedCount = 0;
            let duplicateCount = 0;
            
            names.forEach(name => {
                if (addStaff(name, type, true)) {
                    addedCount++;
                } else {
                    duplicateCount++;
                }
            });
            
            input.value = '';
            renderStaffListMain(type);
            
            if (addedCount > 0) {
                const typeLabel = type === 'ae' ? 'AE' : 'AE-QT';
                showNotification(`âœ… ÄÃ£ thÃªm ${addedCount} nhÃ¢n viÃªn vÃ o ${typeLabel}${duplicateCount > 0 ? ` (${duplicateCount} trÃ¹ng)` : ''}`);
            } else if (duplicateCount > 0) {
                alert('Táº¥t cáº£ tÃªn Ä‘Ã£ tá»“n táº¡i trong danh sÃ¡ch!');
            }
        }

        // Render staff list
        window.renderStaffListMain = function(type) {
            loadStaffListData();
            
            const searchId = type === 'ae' ? 'staff-search-ae' : 'staff-search-aeqt';
            const containerId = type === 'ae' ? 'staff-list-ae' : 'staff-list-aeqt';
            const emptyStateId = type === 'ae' ? 'staff-empty-ae' : 'staff-empty-aeqt';
            const buttonColor = type === 'ae' ? '#3b82f6' : '#f59e0b';
            
            const searchInput = document.getElementById(searchId);
            const searchTerm = searchInput ? searchInput.value.trim().toLowerCase() : '';
            
            const list = type === 'ae' ? staffListAE : staffListAEQT;
            const filteredList = list.filter(name => 
                name.toLowerCase().includes(searchTerm)
            );

            const container = document.getElementById(containerId);
            const emptyState = document.getElementById(emptyStateId);

            if (!container || !emptyState) return;

            if (filteredList.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            container.innerHTML = filteredList.map(name => `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; background: white; border: 1px solid #e5e7eb; border-radius: 6px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 16px;">${type === 'ae' ? 'ğŸ’¼' : 'ğŸŒ'}</span>
                        <span style="font-weight: 600; color: #1f2937; font-size: 13px;">${name}</span>
                    </div>
                    <div style="display: flex; gap: 6px;">
                        <button onclick="editStaffFromMain('${name.replace(/'/g, "\\'")}', '${type}')" style="padding: 5px 10px; background: ${buttonColor}; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;">âœï¸ Sá»­a</button>
                        <button onclick="deleteStaffFromMain('${name.replace(/'/g, "\\'")}', '${type}')" style="padding: 5px 10px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        // Edit staff from main
        window.editStaffFromMain = function(oldName, type) {
            const newName = prompt('Sá»­a tÃªn nhÃ¢n viÃªn:', oldName);
            if (newName && newName.trim() && newName.trim() !== oldName) {
                if (editStaff(oldName, newName.trim(), type)) {
                    renderStaffListMain(type);
                }
            }
        }

        // Delete staff from main
        window.deleteStaffFromMain = function(name, type) {
            if (confirm(`XÃ¡c nháº­n xÃ³a nhÃ¢n viÃªn "${name}"?`)) {
                if (deleteStaff(name, type)) {
                    renderStaffListMain(type);
                }
            }
        }

        // Sort staff list
        window.sortStaffListMain = function(type) {
            sortStaffList(type);
            renderStaffListMain(type);
        }

        // Export staff list
        window.exportStaffListMain = function(type) {
            exportStaffList(type);
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
